---
title: "CUNY SPS DATA 607 Project 2"
author: "Betsy Rosalen"
date: "March 11, 2018"
output:
  html_document:
    theme: cerulean
    toc: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Assignment Instructions

*The goal of this assignment is to give you practice in preparing different datasets for downstream analysis work.*

Your task is to:

1. Choose any three of the “wide” datasets identified in the Week 5 Discussion items. (You may use your own dataset; please don’t use my Sample Post dataset, since that was used in your Week 5 assignment!) For each of the three chosen datasets:
    - Create a .CSV file (or optionally, a MySQL database!) that includes all of the information included in the dataset. You’re encouraged to use a “wide” structure similar to how the information appears in the discussion item, so that you can practice tidying and transformations as described below.
    - Read the information from your .CSV file into R, and use tidyr and dplyr as needed to tidy and transform your data. [Most of your grade will be based on this step!]
    - Perform the analysis requested in the discussion item.
    - Your code should be in an R Markdown file, posted to rpubs.com, and should include narrative descriptions of your data cleanup work, analysis, and conclusions.
2. Please include in your homework submission, for each of the three chosen datasets:
    - The URL to the .Rmd file in your GitHub repository, and
    - The URL for your rpubs.com web page.

# Dataset One

## Load the Raw Data into R from CSV File

```{R LoadMovieCSV}
library(RCurl) 
x <- getURL("https://raw.githubusercontent.com/betsyrosalen/DATA_607_Data_Acquisition_and_Management/master/Assignment2/Movie%20Ratings.csv") 
movies <-data.frame(read.csv(text=x, header=TRUE))
dim(movies)
head(movies, 3)
```

## Use tidyr to move header row to Movie column

```{r}
library(tidyr)
tidymovies <- gather(movies, key = 'Movie', value = 'Rating', 3:12)
dplyr::sample_frac(tidymovies, 0.03, replace=FALSE)
```

## Remove Timestamp column since it's irrelevant

The timestamp is just a default of Google Forms that records when teh form was submitted, but this info really is not relevant to our movie ratings at all, so I am removing it.

```{r}
library(dplyr)
tidymovies <- tidymovies[,2:5]
#also get rid of Number.of.Movies.Seen while I'm at it...
tidymovies <- tidymovies[,-2]
dplyr::sample_frac(tidymovies, 0.03, replace=FALSE)
```

## Change zeros to NA's

My original [Movie Ratings] form specified that zero meant the reviewer had not seen the movie, so I want to change all zero's to NA's so that they can be excluded from calculations.

```{r}
tidymovies$Rating[tidymovies$Rating == 0] <- NA
dplyr::sample_frac(tidymovies, 0.03, replace=FALSE)
```

## Use dplyr to split first and last names and then remove last names

```{r}
tidymovies <- separate(tidymovies, Name, c("First", "Last"), sep=" ")
# I tried to pipe the previous line into this line, but that didn't work for some reason?
tidymovies <- select(tidymovies, First, Movie, Rating)
dplyr::sample_frac(tidymovies, 0.03, replace=FALSE)
```

## Replace all the periods in the movie names with a space

```{r}
library(stringr)
tidymovies$Movie <- str_replace_all(tidymovies$Movie, "\\.+", " ")
library(DT)
datatable(tidymovies)
```

## Summary analysis with dplyr

```{r}
# Remove rows with no Rating
reviews <- tidymovies[!is.na(tidymovies$Rating),]

# Num of ratings for each film
ratings_per_film <- reviews %>% 
  group_by(Movie) %>%
  summarise(Num_Reviews = n_distinct(First)) %>% 
  arrange(desc(Num_Reviews))
ratings_per_film
```
```{r}
avg_rating_by_movie <- tidymovies %>% 
  group_by(Movie) %>%
  summarise(avg = round(mean(Rating, na.rm=TRUE),2)) %>%
  full_join(ratings_per_film) %>%
  arrange(desc(avg))
avg_rating_by_movie
```

```{r}
library(ggplot2)
ggplot(tidymovies) +
  geom_point(mapping = aes(x=Rating, y=Movie, color=First))
```



```{r}
# Num of ratings for each reviewer
num_ratings <- reviews %>% 
  group_by(First) %>%
  summarise(Num_Reviews = n_distinct(Movie)) %>% 
  arrange(desc(Num_Reviews))
num_ratings
```

```{r}
# Average rating given by each reviewer
avg_rating_by_reviewer <- tidymovies %>% 
  group_by(First) %>%
  summarise(avg = round(mean(Rating, na.rm=TRUE),2)) %>% 
  full_join(num_ratings) %>%
  arrange(desc(avg))
avg_rating_by_reviewer
```